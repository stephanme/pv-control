<mat-toolbar color="primary">
  <mat-icon class="col-yellow mr-1">wb_sunny</mat-icon>
  <span>PV Control</span>
  <span fxFlex="grow"></span>
  <mat-slide-toggle [formControl]="autoRefreshControl"></mat-slide-toggle>
  <button id="refresh" mat-icon-button aria-label="Refresh" (click)="refresh()">
    <mat-icon [class.spin]="busy$ | async">autorenew</mat-icon>
  </button>
</mat-toolbar>
<div class="content">
  <div gdColumns="1fr 1fr" gdColumns.gt-xs="300px 300px" fxLayoutAlign="center" gdGap="10px">
    <div>
      <mat-card id="card-pv" class="mat-elevation-z4">
        <mat-card-title><mat-icon [inline]="true" class="col-yellow">wb_sunny</mat-icon><span fxFlex="grow" class="text-right">{{pvControl.meter.power_pv/1000|number:'1.1-1'}} kW</span></mat-card-title>
      </mat-card>
    </div>
    <div>
      <mat-card id="card-grid" class="mat-elevation-z4">
        <mat-card-title><mat-icon [inline]="true" [class.col-green]="pvControl.meter.power_grid <= 0" [class.col-red]="pvControl.meter.power_grid > 0">power</mat-icon><span fxFlex="grow" class="text-right">{{pvControl.meter.power_grid/1000|number:'1.1-1'}} kW</span></mat-card-title>
      </mat-card>
    </div>
    <div>
      <mat-card id="card-home" class="mat-elevation-z4">
        <mat-card-title><mat-icon [inline]="true" [class.col-primary]="pvControl.meter.error <= 3" [class.col-grey]="pvControl.meter.error > 3">home</mat-icon>
          <span fxFlex="grow" class="text-right">{{(pvControl.meter.power_consumption - pvControl.wallbox.power)/1000|number:'1.1-1'}} kW</span>
        </mat-card-title>
      </mat-card>
    </div>
    <div>
      <mat-card id="card-car" class="mat-elevation-z4">
        <mat-card-title><mat-icon [inline]="true" [class.col-primary]="pvControl.car.error <= 3" [class.col-grey]="pvControl.car.error > 3">electric_car</mat-icon>
          <span fxFlex="grow" class="text-right">{{pvControl.car.soc|number:'1.0-0'}} %</span>
        </mat-card-title>
      </mat-card>
    </div>

    <div gdColumn="span 2">
      <mat-card id="card-chargemode" class="mat-elevation-z4">
        <mat-card-title fxLayoutAlign="space">
          <mat-icon fxFlex="grow" [inline]="true" [class.col-primary]="pvControl.wallbox.error <= 3" [class.col-grey]="pvControl.wallbox.error > 3">ev_station</mat-icon>
          <span id="car-max-current" *ngIf="isCharging" fxFlex="none" class="text-center">{{pvControl.wallbox.phases_out}}x {{pvControl.wallbox.max_current}} A</span>
          <span id="car-charge-power" *ngIf="isCharging" fxFlex="grow" class="text-right">{{pvControl.wallbox.power/1000|number:'1.1-1'}} kW</span>
          <mat-icon id="car-charge-state" *ngIf="!isCharging" fxFlex="grow" [inline]="true" class="text-right" fontSet="material-icons-two-tone">{{chargingStateIcon}}</mat-icon>
        </mat-card-title>
        <mat-card-content>
          <mat-button-toggle-group id="chargeModeToogle" fxLayout="row" fxLayoutAlign="center" [formControl]="chargeModeControl" (change)="onChargeModeChange($event)" aria-label="Charge Mode">
            <mat-button-toggle id="chargeModeOFF" fxFlex="grow" [value]="ChargeMode.OFF" [class.mat-body-strong]="pvControl.controller.mode===ChargeMode.OFF">Off</mat-button-toggle>
            <mat-button-toggle id="chargeModePV_ONLY" fxFlex="grow" [value]="ChargeMode.PV_ONLY" [class.mat-body-strong]="pvControl.controller.mode===ChargeMode.PV_ONLY">PV only</mat-button-toggle>
            <mat-button-toggle id="chargeModePV_ALL" fxFlex="grow" [value]="ChargeMode.PV_ALL" [class.mat-body-strong]="pvControl.controller.mode===ChargeMode.PV_ALL">PV all</mat-button-toggle>
            <mat-button-toggle id="chargeModeMAX" fxFlex="grow" [value]="ChargeMode.MAX" [class.mat-body-strong]="pvControl.controller.mode===ChargeMode.MAX">Max</mat-button-toggle>
            <mat-button-toggle id="chargeModeMANUAL" fxFlex="grow" [value]="ChargeMode.MANUAL" [class.mat-body-strong]="pvControl.controller.mode===ChargeMode.MANUAL">Manual</mat-button-toggle>
          </mat-button-toggle-group>
        </mat-card-content>
        <mat-card-content>
          <mat-button-toggle-group fxLayout="row" fxLayoutAlign="center" id="phaseModeToogle" [formControl]="phaseModeControl" (change)="onPhaseModeChange($event)" aria-label="Phase Mode">
            <mat-button-toggle id="phaseModeAUTO" fxFlex="grow" [value]="PhaseMode.AUTO">Auto</mat-button-toggle>
            <mat-button-toggle id="phaseModeCHARGE_1P" fxFlex="grow" [value]="PhaseMode.CHARGE_1P" [class.mat-body-strong]="pvControl.wallbox.phases_in===1">1 Phase</mat-button-toggle>
            <mat-button-toggle id="phaseModeCHARGE_3P" fxFlex="grow" [value]="PhaseMode.CHARGE_3P" [class.mat-body-strong]="pvControl.wallbox.phases_in===3">3 Phases</mat-button-toggle>
          </mat-button-toggle-group>
        </mat-card-content>
      </mat-card>
    </div>

    <div>
      <mat-card id="card-temp" class="mat-elevation-z4">
        <mat-card-title><mat-icon [inline]="true" [class.col-primary]="pvControl.wallbox.error <= 3" [class.col-grey]="pvControl.wallbox.error > 3">thermostat</mat-icon>
          <span fxFlex="grow" class="text-right">{{pvControl.wallbox.temperature|number:'1.0-0'}} Â°C</span>
        </mat-card-title>
      </mat-card>
    </div>
  </div>
</div>